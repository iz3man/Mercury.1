#[respond]
#[include chopper_tune.cfg]
[include cartographer.cfg]
[include ebb36.cfg]
[include shell_command.cfg]
[include mainsail.cfg]
[include macros.cfg]
#[include filament_dryer.cfg]

[save_variables]
filename: /home/pi/printer_data/config/variables.cfg

#[auto_speed]

[shaketune]
timeout: 1000

[mcu]
serial: /dev/serial/by-id/usb-Klipper_rp2040_4550357128952208-if00

[idle_timeout]
timeout: 1800                        # Idle time (in seconds) to wait before running the above G-Code

[bed_mesh]
zero_reference_position: 112, 112    # set this to the middle of your bed
speed: 300                           # movement speed of toolhead during bed mesh
horizontal_move_z: 5                 # height of scanner during bed mesh scan
mesh_min: 10,10 
mesh_max: 200,200 
probe_count: 30,30
algorithm: bicubic

[resonance_tester]
accel_chip: adxl345
probe_points: 125, 125, 20

[axis_twist_compensation]
speed: 200
#   The speed (in mm/s) of non-probing moves during the calibration.
#   The default is 50.
horizontal_move_z: 5
#   The height (in mm) that the head should be commanded to move to
#   just prior to starting a probe operation. The default is 5.
calibrate_start_x: 20
#   Defines the minimum X coordinate of the calibration
#   This should be the X coordinate that positions the nozzle at the starting
#   calibration position. This parameter must be provided.
calibrate_end_x: 200
#   Defines the maximum X coordinate of the calibration
#   This should be the X coordinate that positions the nozzle at the ending
#   calibration position. This parameter must be provided.
calibrate_y: 110
#   Defines the Y coordinate of the calibration
#   This should be the Y coordinate that positions the nozzle during the
#   calibration process. This parameter must be provided and is recommended to
#   be near the center of the bed

[skew_correction] 

[gcode_arcs]
resolution: 0.1

[exclude_object]

[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT


[stepper_x]
# stepper B links
step_pin: gpio11
dir_pin: gpio10
enable_pin: !gpio12
microsteps: 64
#microsteps: 128
full_steps_per_rotation: 200
rotation_distance: 40
endstop_pin: EBB36: PB5
#endstop_pin: tmc2209_stepper_x:virtual_endstop
homing_speed: 120
homing_retract_dist: 0
position_endstop: 230
position_max: 230
position_min: -30

[tmc2209 stepper_x]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 0
run_current: 0.8
stealthchop_threshold: 0
#hold_current: 0.6
#stealthchop_threshold: 999999
diag_pin: ^gpio4
driver_SGTHRS: 100

[stepper_y]
# stepper A rechts
step_pin: gpio6
dir_pin: gpio5
enable_pin: !gpio7
microsteps: 64
#microsteps: 128
full_steps_per_rotation: 200
rotation_distance: 40
homing_speed: 80
homing_retract_dist: 0
endstop_pin: gpio3
# tmc2209_stepper_y:virtual_endstop
position_endstop: 245
position_max: 245
position_min: -25

[tmc2209 stepper_y]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 2
run_current: 0.8
stealthchop_threshold: 0
#hold_current: 0.6
#stealthchop_threshold: 999999
diag_pin: ^gpio3
driver_SGTHRS: 150

[stepper_z]
# rechts
step_pin: gpio19
dir_pin: !gpio28
enable_pin: !gpio2
microsteps: 16
rotation_distance: 4
endstop_pin: probe:z_virtual_endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 200
position_min: -30
#position_min: -2
homing_speed: 15

[tmc2209 stepper_z]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 1
run_current: 0.6
hold_current: 0.500
stealthchop_threshold: 999999

[stepper_z1]
# links
step_pin: gpio14
dir_pin: gpio13
enable_pin: !gpio15
microsteps: 16
rotation_distance: 4

[tmc2209 stepper_z1]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 3
run_current: 0.6
hold_current: 0.500
stealthchop_threshold: 999999

[z_tilt]
z_positions:
  275,110  # rechts
  -55,110 # links
points:
   10,115
   210,115
speed: 200
horizontal_move_z: 5
retries: 3
retry_tolerance: 0.01

[safe_z_home]
home_xy_position: 110,110
z_hop: 5

[heater_bed]
heater_pin: gpio21
pwm_cycle_time: 0.02
sensor_type: EPCOS 100K B57560G104F
sensor_pin: gpio26
min_temp: 0
max_temp: 130
control = pid
pid_kp = 53.887
pid_ki = 2.548
pid_kd = 284.925

[controller_fan fet_cooling]
pin: gpio17
max_power: 1.0
fan_speed: 1
cycle_time: 0.01
kick_start_time: 0
stepper: stepper_x

[fan_generic filter]
pin: gpio20
cycle_time: 0.01
hardware_pwm: true

#[fan_generic controller_fan]
#pin: gpio17

[printer]
kinematics: corexy
max_velocity: 700
max_accel: 10000
max_z_velocity: 15
max_z_accel: 30

[screws_tilt_adjust]
screw1: 36, -18
screw1_name: front left screw

screw2: 206, -18
screw2_name: front right screw

screw3: 206, 150
screw3_name: rear right screw

screw4: 36, 150
screw4_name: rear left screw
horizontal_move_z: 5
speed: 200
screw_thread: CW-M4

[temperature_sensor pico]
sensor_type: temperature_mcu

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner model default]
#*# model_coef = 1.4531752902859216,
#*# 	  1.77867763073563,
#*# 	  0.7827446322833205,
#*# 	  0.38028329408865114,
#*# 	  0.2780617489518031,
#*# 	  0.2594173671059797,
#*# 	  -0.09244167072914868,
#*# 	  -0.11861340727027493,
#*# 	  0.2287491337260288,
#*# 	  0.15148291086035043
#*# model_domain = 3.1789125603665074e-07,3.3485397972281466e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 34.313734
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [scanner]
#*# scanner_touch_threshold = 3250
#*# scanner_touch_z_offset = 0.120
#*# mode = touch
#*# scanner_touch_speed = 3
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.192156, -0.175119, -0.175216, -0.175030, -0.173344, -0.173308, -0.170314, -0.165547, -0.159265, -0.153545, -0.143358, -0.130953, -0.118437, -0.100513, -0.082604, -0.062252, -0.044606, -0.025279, -0.003700, 0.019885, 0.044756, 0.070928, 0.099864, 0.131379, 0.167562, 0.209261, 0.245036, 0.292407, 0.338019, 0.382050
#*# 	-0.198946, -0.182106, -0.180827, -0.177709, -0.176964, -0.175671, -0.171495, -0.166516, -0.159373, -0.151099, -0.141814, -0.129580, -0.115280, -0.099019, -0.080075, -0.061547, -0.042611, -0.023202, -0.002012, 0.024607, 0.050373, 0.075232, 0.104593, 0.137712, 0.172284, 0.210880, 0.252785, 0.294013, 0.341352, 0.387024
#*# 	-0.208347, -0.190914, -0.186762, -0.183909, -0.182292, -0.180618, -0.174470, -0.167775, -0.161384, -0.152301, -0.142786, -0.130383, -0.116713, -0.100496, -0.082387, -0.064878, -0.046485, -0.025548, -0.002291, 0.023620, 0.048663, 0.073356, 0.103805, 0.136621, 0.171874, 0.211395, 0.254646, 0.291424, 0.340126, 0.383646
#*# 	-0.215977, -0.197946, -0.196007, -0.191915, -0.188704, -0.184941, -0.177683, -0.170589, -0.162464, -0.154859, -0.144100, -0.132636, -0.117761, -0.100189, -0.083550, -0.065100, -0.049712, -0.030313, -0.007868, 0.022647, 0.046411, 0.072433, 0.102538, 0.135559, 0.170720, 0.210632, 0.251690, 0.292484, 0.336925, 0.383461
#*# 	-0.223252, -0.207045, -0.201212, -0.198866, -0.194467, -0.190616, -0.180640, -0.174277, -0.164926, -0.157391, -0.146053, -0.132684, -0.117432, -0.099546, -0.080929, -0.064795, -0.050896, -0.032346, -0.008808, 0.019104, 0.047247, 0.070922, 0.102487, 0.134458, 0.170824, 0.207930, 0.250673, 0.292164, 0.335457, 0.382391
#*# 	-0.225464, -0.206611, -0.203943, -0.199288, -0.194275, -0.189049, -0.181405, -0.173861, -0.165008, -0.156261, -0.143948, -0.128873, -0.114204, -0.095692, -0.080566, -0.065893, -0.049521, -0.030519, -0.003542, 0.021242, 0.047852, 0.074605, 0.107195, 0.138751, 0.173671, 0.210951, 0.255421, 0.296431, 0.340995, 0.386914
#*# 	-0.223986, -0.206157, -0.202373, -0.196329, -0.192127, -0.186964, -0.178248, -0.168944, -0.159535, -0.148873, -0.138511, -0.122337, -0.116002, -0.094472, -0.075854, -0.063894, -0.045573, -0.025887, -0.000650, 0.024169, 0.051205, 0.081053, 0.111201, 0.143945, 0.179725, 0.217452, 0.257353, 0.301289, 0.342910, 0.389015
#*# 	-0.215512, -0.203920, -0.200719, -0.195627, -0.189155, -0.181876, -0.170606, -0.163326, -0.153317, -0.142337, -0.134562, -0.119832, -0.106949, -0.091160, -0.072709, -0.057779, -0.039515, -0.018883, 0.003368, 0.029794, 0.056555, 0.086526, 0.118360, 0.151159, 0.186345, 0.223501, 0.263489, 0.306033, 0.349295, 0.393367
#*# 	-0.209393, -0.204425, -0.198865, -0.195306, -0.187072, -0.182339, -0.167422, -0.163123, -0.151920, -0.140273, -0.131156, -0.118141, -0.105521, -0.090485, -0.073797, -0.053734, -0.036600, -0.015094, 0.008606, 0.033251, 0.060049, 0.091330, 0.119991, 0.156133, 0.192835, 0.229967, 0.271431, 0.311171, 0.353240, 0.399410
#*# 	-0.206423, -0.205306, -0.201354, -0.195569, -0.188702, -0.179723, -0.170168, -0.161029, -0.151640, -0.141137, -0.131850, -0.119356, -0.108265, -0.093562, -0.075786, -0.056486, -0.034535, -0.012812, 0.009714, 0.040748, 0.065922, 0.093261, 0.125329, 0.161636, 0.199921, 0.235774, 0.276105, 0.314063, 0.357480, 0.400919
#*# 	-0.202293, -0.201340, -0.198892, -0.192136, -0.185155, -0.175572, -0.163972, -0.154696, -0.147273, -0.142132, -0.125269, -0.112738, -0.098449, -0.084319, -0.066448, -0.045852, -0.026347, -0.006181, 0.019800, 0.040497, 0.073865, 0.104237, 0.132821, 0.166868, 0.203401, 0.240664, 0.280472, 0.320030, 0.363399, 0.405708
#*# 	-0.193105, -0.192722, -0.188940, -0.183686, -0.175825, -0.169519, -0.158995, -0.150535, -0.141628, -0.123904, -0.115270, -0.103832, -0.092621, -0.081042, -0.061372, -0.043237, -0.026205, -0.011318, 0.018401, 0.057203, 0.079852, 0.113570, 0.140515, 0.177934, 0.214471, 0.258295, 0.292873, 0.332385, 0.376454, 0.418687
#*# 	-0.179008, -0.178609, -0.176473, -0.172775, -0.167379, -0.159668, -0.145456, -0.133336, -0.125937, -0.116052, -0.100408, -0.093917, -0.085861, -0.070854, -0.052692, -0.034669, -0.016281, 0.004746, 0.026207, 0.057483, 0.087992, 0.130596, 0.166053, 0.198898, 0.236261, 0.273087, 0.307170, 0.345881, 0.388539, 0.431558
#*# 	-0.172869, -0.172446, -0.170306, -0.162058, -0.153803, -0.140338, -0.131206, -0.125638, -0.118168, -0.106371, -0.102385, -0.092451, -0.081649, -0.065023, -0.045798, -0.025717, -0.007286, 0.012543, 0.037224, 0.067681, 0.095859, 0.127039, 0.166288, 0.205264, 0.247271, 0.280638, 0.318566, 0.360640, 0.402756, 0.446606
#*# 	-0.160123, -0.158445, -0.161199, -0.155777, -0.149011, -0.137718, -0.130549, -0.123413, -0.118371, -0.111858, -0.104039, -0.091538, -0.077551, -0.061185, -0.041040, -0.019073, -0.001238, 0.019963, 0.043241, 0.071506, 0.102321, 0.137522, 0.175413, 0.217723, 0.252577, 0.283143, 0.322997, 0.372293, 0.412229, 0.453379
#*# 	-0.160436, -0.161708, -0.161257, -0.152821, -0.148843, -0.142007, -0.134946, -0.127992, -0.120850, -0.111493, -0.099909, -0.088156, -0.073285, -0.056440, -0.036945, -0.014263, 0.004222, 0.025765, 0.049871, 0.077297, 0.108327, 0.142353, 0.177110, 0.221806, 0.255911, 0.297350, 0.338111, 0.377010, 0.423242, 0.464784
#*# 	-0.156296, -0.155703, -0.155384, -0.150851, -0.147602, -0.143105, -0.135042, -0.128959, -0.117016, -0.106616, -0.095505, -0.083006, -0.068585, -0.051975, -0.031243, -0.010864, 0.011243, 0.031860, 0.057123, 0.084486, 0.114522, 0.148462, 0.186214, 0.222742, 0.255545, 0.295313, 0.336797, 0.383161, 0.432282, 0.473798
#*# 	-0.152701, -0.152600, -0.149990, -0.145277, -0.140510, -0.135528, -0.127651, -0.119186, -0.111010, -0.098483, -0.087817, -0.074065, -0.060850, -0.043156, -0.023136, -0.000238, 0.019483, 0.041793, 0.066209, 0.093148, 0.123413, 0.155970, 0.193208, 0.232090, 0.271422, 0.312359, 0.353222, 0.394171, 0.439372, 0.485493
#*# 	-0.141441, -0.140531, -0.137638, -0.133012, -0.127567, -0.122225, -0.115364, -0.106342, -0.096597, -0.086504, -0.072735, -0.062010, -0.046759, -0.027686, -0.008036, 0.015132, 0.035562, 0.056894, 0.080791, 0.108982, 0.138763, 0.169895, 0.207761, 0.246371, 0.285689, 0.327590, 0.368463, 0.410765, 0.453892, 0.502144
#*# 	-0.126909, -0.126139, -0.123692, -0.118461, -0.113896, -0.107419, -0.100230, -0.091912, -0.082155, -0.070432, -0.060108, -0.045592, -0.030201, -0.012763, 0.008793, 0.030888, 0.050960, 0.073126, 0.096923, 0.125848, 0.155269, 0.188292, 0.222928, 0.261296, 0.301148, 0.341098, 0.384060, 0.424109, 0.468552, 0.513861
#*# 	-0.114075, -0.113410, -0.110841, -0.107911, -0.101690, -0.096506, -0.089402, -0.080215, -0.070992, -0.058580, -0.046059, -0.032364, -0.015410, 0.002700, 0.023157, 0.044179, 0.064937, 0.086101, 0.112075, 0.139303, 0.169648, 0.201290, 0.235783, 0.273072, 0.312812, 0.352897, 0.393413, 0.435620, 0.478349, 0.521896
#*# 	-0.106192, -0.100853, -0.098368, -0.093140, -0.089840, -0.085278, -0.077426, -0.069467, -0.058295, -0.047962, -0.033562, -0.019891, -0.003626, 0.014356, 0.033806, 0.056758, 0.077031, 0.099055, 0.124615, 0.151610, 0.182438, 0.213305, 0.246933, 0.284217, 0.322105, 0.363402, 0.404333, 0.444534, 0.488545, 0.531409
#*# 	-0.099049, -0.087196, -0.084498, -0.079371, -0.076570, -0.069761, -0.064676, -0.057040, -0.045436, -0.034217, -0.020905, -0.007007, 0.009090, 0.026143, 0.047148, 0.069162, 0.091320, 0.113675, 0.139473, 0.167175, 0.197436, 0.227554, 0.262496, 0.298996, 0.337963, 0.376894, 0.417887, 0.458362, 0.500828, 0.544796
#*# 	-0.084482, -0.072428, -0.067537, -0.062843, -0.059257, -0.055620, -0.048588, -0.041779, -0.030615, -0.019882, -0.006651, 0.007727, 0.023754, 0.043100, 0.063603, 0.086614, 0.108195, 0.129869, 0.154526, 0.181327, 0.211830, 0.242797, 0.277151, 0.313314, 0.352085, 0.390644, 0.432769, 0.473556, 0.518132, 0.559964
#*# 	-0.071489, -0.054519, -0.052722, -0.048587, -0.045296, -0.039570, -0.035193, -0.026572, -0.016731, -0.005473, 0.007739, 0.022612, 0.039706, 0.058440, 0.079135, 0.104106, 0.123843, 0.144777, 0.168706, 0.196902, 0.226403, 0.258373, 0.292089, 0.327420, 0.366794, 0.407282, 0.448352, 0.490712, 0.533077, 0.576572
#*# 	-0.055539, -0.041694, -0.038063, -0.033443, -0.030945, -0.027353, -0.019393, -0.012552, -0.003219, 0.008910, 0.021223, 0.035845, 0.054247, 0.072411, 0.096043, 0.117963, 0.139332, 0.160538, 0.184490, 0.211887, 0.240143, 0.273453, 0.304862, 0.342376, 0.379830, 0.421363, 0.460107, 0.502694, 0.545943, 0.590340
#*# 	-0.042376, -0.026856, -0.025700, -0.024108, -0.020326, -0.017246, -0.010685, -0.003744, 0.007312, 0.018796, 0.031318, 0.046593, 0.065316, 0.085402, 0.105749, 0.129502, 0.150900, 0.172838, 0.196392, 0.224041, 0.251789, 0.284527, 0.316024, 0.354101, 0.390196, 0.429424, 0.471142, 0.512291, 0.554621, 0.601501
#*# 	-0.031292, -0.018177, -0.015848, -0.013936, -0.012564, -0.008203, -0.003938, 0.002559, 0.013728, 0.024163, 0.039347, 0.054721, 0.071656, 0.091710, 0.113333, 0.136368, 0.158494, 0.181650, 0.205004, 0.232362, 0.260558, 0.292460, 0.326479, 0.360965, 0.398491, 0.439107, 0.477790, 0.519719, 0.565036, 0.610950
#*# 	-0.020330, -0.005960, -0.004825, -0.004007, -0.001727, 0.003055, 0.005859, 0.011066, 0.021833, 0.034119, 0.047874, 0.063762, 0.082177, 0.101599, 0.123722, 0.145211, 0.166869, 0.189518, 0.213784, 0.241199, 0.270577, 0.302094, 0.335185, 0.370617, 0.406779, 0.446875, 0.488302, 0.530051, 0.575401, 0.620951
#*# 	-0.002730, 0.005762, 0.006688, 0.007561, 0.008791, 0.010602, 0.016199, 0.021817, 0.032038, 0.043049, 0.056973, 0.072742, 0.090741, 0.110729, 0.132366, 0.156643, 0.177746, 0.201924, 0.226109, 0.253217, 0.280929, 0.314475, 0.346490, 0.382049, 0.420046, 0.461656, 0.501637, 0.543824, 0.589353, 0.635528
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 200.0
#*# min_y = 10.0
#*# max_y = 200.0
#*#
#*# [axis_twist_compensation]
#*# z_compensations = -0.013931, 0.023180, -0.009249
#*# compensation_start_x = 20.0
#*# compensation_end_x = 200.0