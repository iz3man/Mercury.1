#[respond]
#[include chopper_tune.cfg]
[include cartographer.cfg]
[include ebb36.cfg]
[include shell_command.cfg]
[include mainsail.cfg]
#[include klicky-probe.cfg]
#[include macro_rename.cfg]
[include macros.cfg]
#[include tmc_autotune.cfg]
#[include K-ShakeTune/*.cfg]
#[include calibrate.cfg]
#[include backup.cfg]
#[include filament_dryer.cfg]

[save_variables]
filename: /home/pi/printer_data/config/variables.cfg

#[auto_speed]

[shaketune]
timeout: 1000

[mcu]
serial: /dev/serial/by-id/usb-Klipper_rp2040_4550357128952208-if00

[idle_timeout]
timeout: 1800                        # Idle time (in seconds) to wait before running the above G-Code

[bed_mesh]
zero_reference_position: 112, 112    # set this to the middle of your bed
speed: 300                           # movement speed of toolhead during bed mesh
horizontal_move_z: 5                 # height of scanner during bed mesh scan
mesh_min: 10,10 
mesh_max: 200,200 
probe_count: 30,30
algorithm: bicubic

[resonance_tester]
accel_chip: adxl345
probe_points: 125, 125, 20

[axis_twist_compensation]
speed: 200
#   The speed (in mm/s) of non-probing moves during the calibration.
#   The default is 50.
horizontal_move_z: 5
#   The height (in mm) that the head should be commanded to move to
#   just prior to starting a probe operation. The default is 5.
calibrate_start_x: 20
#   Defines the minimum X coordinate of the calibration
#   This should be the X coordinate that positions the nozzle at the starting
#   calibration position. This parameter must be provided.
calibrate_end_x: 200
#   Defines the maximum X coordinate of the calibration
#   This should be the X coordinate that positions the nozzle at the ending
#   calibration position. This parameter must be provided.
calibrate_y: 110
#   Defines the Y coordinate of the calibration
#   This should be the Y coordinate that positions the nozzle during the
#   calibration process. This parameter must be provided and is recommended to
#   be near the center of the bed

[skew_correction] 

[gcode_arcs]
resolution: 0.1

[exclude_object]

[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT


[stepper_x]
# stepper B links
step_pin: gpio11
dir_pin: gpio10
enable_pin: !gpio12
microsteps: 64
#microsteps: 128
full_steps_per_rotation: 200
rotation_distance: 40
endstop_pin: EBB36: PB5
#endstop_pin: tmc2209_stepper_x:virtual_endstop
homing_speed: 120
homing_retract_dist: 0
position_endstop: 230
position_max: 230
position_min: -30

[tmc2209 stepper_x]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 0
run_current: 0.8
stealthchop_threshold: 0
#hold_current: 0.6
#stealthchop_threshold: 999999
diag_pin: ^gpio4
driver_SGTHRS: 100

[stepper_y]
# stepper A rechts
step_pin: gpio6
dir_pin: gpio5
enable_pin: !gpio7
microsteps: 64
#microsteps: 128
full_steps_per_rotation: 200
rotation_distance: 40
homing_speed: 80
homing_retract_dist: 0
endstop_pin: gpio3
# tmc2209_stepper_y:virtual_endstop
position_endstop: 245
position_max: 245
position_min: -25

[tmc2209 stepper_y]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 2
run_current: 0.8
stealthchop_threshold: 0
#hold_current: 0.6
#stealthchop_threshold: 999999
diag_pin: ^gpio3
driver_SGTHRS: 150

[stepper_z]
# rechts
step_pin: gpio19
dir_pin: !gpio28
enable_pin: !gpio2
microsteps: 16
rotation_distance: 4
endstop_pin: probe:z_virtual_endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 200
position_min: -2
homing_speed: 15

[tmc2209 stepper_z]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 1
run_current: 0.6
hold_current: 0.500
stealthchop_threshold: 999999

[stepper_z1]
# links
step_pin: gpio14
dir_pin: gpio13
enable_pin: !gpio15
microsteps: 16
rotation_distance: 4

[tmc2209 stepper_z1]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 3
run_current: 0.6
hold_current: 0.500
stealthchop_threshold: 999999

[z_tilt]
z_positions:
  275,110  # rechts
  -55,110 # links
points:
   10,115
   210,115
speed: 200
horizontal_move_z: 5
retries: 3
retry_tolerance: 0.01

[safe_z_home]
home_xy_position: 110,110
z_hop: 5

[heater_bed]
heater_pin: gpio21
pwm_cycle_time: 0.02
sensor_type: EPCOS 100K B57560G104F
sensor_pin: gpio26
min_temp: 0
max_temp: 130
control = pid
pid_kp = 53.887
pid_ki = 2.548
pid_kd = 284.925

[controller_fan fet_cooling]
pin: gpio17
max_power: 1.0
fan_speed: 1
cycle_time: 0.01
kick_start_time: 0
stepper: stepper_x

[fan_generic filter]
pin: gpio20
cycle_time: 0.01
hardware_pwm: true

#[fan_generic controller_fan]
#pin: gpio17

[printer]
kinematics: corexy
max_velocity: 700
max_accel: 10000
max_z_velocity: 15
max_z_accel: 30

[screws_tilt_adjust]
screw1: 36, -18
screw1_name: front left screw

screw2: 206, -18
screw2_name: front right screw

screw3: 206, 150
screw3_name: rear right screw

screw4: 36, 150
screw4_name: rear left screw
horizontal_move_z: 5
speed: 200
screw_thread: CW-M4

[temperature_sensor pico]
sensor_type: temperature_mcu

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner model default]
#*# model_coef = 1.3500978041747753,
#*# 	1.7751478933691671,
#*# 	0.7773317642729126,
#*# 	0.39469501876470137,
#*# 	0.36041204766898577,
#*# 	0.2820784486372157,
#*# 	-0.2317789742292619,
#*# 	-0.2096536812656912,
#*# 	0.2947269341771923,
#*# 	0.20951366587567355
#*# model_domain = 3.180146626725119e-07,3.347922159826393e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 24.059814
#*# model_offset = 0.02000
#*# model_mode = scan
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [scanner]
#*# scanner_touch_threshold = 4000
#*# scanner_touch_z_offset = 0.120
#*# mode = touch
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.076749, 0.065076, 0.052584, 0.042998, 0.033889, 0.023439, 0.014021, 0.007522, 0.004888, 0.006957, 0.009262, 0.007650, 0.006940, 0.008406, 0.013545, 0.023553, 0.033951, 0.043568, 0.056893, 0.072569, 0.090501
#*# 	0.070515, 0.057951, 0.045880, 0.035668, 0.028254, 0.016440, 0.006849, 0.001062, -0.001569, 0.000416, 0.002951, 0.003679, 0.002706, 0.003367, 0.010484, 0.019183, 0.028636, 0.040076, 0.054554, 0.069698, 0.087557
#*# 	0.066340, 0.053616, 0.041795, 0.031600, 0.023159, 0.011505, 0.001743, -0.004107, -0.006734, -0.004137, 0.000247, -0.000065, -0.000973, -0.000112, 0.007747, 0.017043, 0.026539, 0.037420, 0.052006, 0.067427, 0.086795
#*# 	0.060740, 0.048888, 0.036957, 0.027719, 0.018605, 0.005897, -0.001441, -0.006277, -0.010623, -0.008301, -0.005631, -0.004977, -0.005754, -0.003425, 0.004479, 0.015044, 0.024729, 0.036000, 0.050054, 0.066302, 0.085021
#*# 	0.059116, 0.045791, 0.033687, 0.024096, 0.014865, 0.004962, -0.003410, -0.009337, -0.012092, -0.010432, -0.006591, -0.007414, -0.008870, -0.005994, 0.001527, 0.012635, 0.022473, 0.033977, 0.048548, 0.065753, 0.083793
#*# 	0.058301, 0.044259, 0.032757, 0.022866, 0.012199, 0.003152, -0.004045, -0.009958, -0.012422, -0.009104, -0.007159, -0.007520, -0.009347, -0.007090, 0.000474, 0.012713, 0.021799, 0.033620, 0.048785, 0.065727, 0.086511
#*# 	0.058037, 0.045461, 0.032561, 0.022454, 0.012975, 0.004009, -0.002905, -0.008431, -0.010907, -0.008372, -0.004850, -0.005285, -0.008236, -0.007493, 0.000614, 0.012034, 0.023158, 0.034667, 0.050101, 0.068230, 0.088116
#*# 	0.061021, 0.045851, 0.034031, 0.024486, 0.014870, 0.006416, -0.000222, -0.005706, -0.007869, -0.004834, -0.001982, -0.002798, -0.005791, -0.004771, 0.002700, 0.013965, 0.025329, 0.037449, 0.052710, 0.070453, 0.090908
#*# 	0.063074, 0.049397, 0.037446, 0.027898, 0.018589, 0.010132, 0.003063, -0.001452, -0.003938, -0.001275, 0.000901, 0.000504, -0.001937, -0.001121, 0.006323, 0.017620, 0.028522, 0.040366, 0.056251, 0.074410, 0.094214
#*# 	0.067497, 0.053428, 0.041570, 0.032065, 0.023810, 0.014724, 0.008436, 0.003651, 0.001913, 0.004139, 0.007040, 0.005393, 0.002195, 0.003291, 0.010720, 0.022341, 0.032962, 0.045039, 0.060788, 0.078944, 0.098326
#*# 	0.072981, 0.059291, 0.046890, 0.037429, 0.030012, 0.020595, 0.013487, 0.009081, 0.008395, 0.010767, 0.013458, 0.011257, 0.007729, 0.008052, 0.015981, 0.027653, 0.038812, 0.050653, 0.065698, 0.084183, 0.103303
#*# 	0.079437, 0.065548, 0.054093, 0.044429, 0.036933, 0.027794, 0.020172, 0.016059, 0.015523, 0.018792, 0.020919, 0.018651, 0.014621, 0.015153, 0.023521, 0.034782, 0.045751, 0.056990, 0.072173, 0.090535, 0.109469
#*# 	0.086773, 0.073886, 0.061783, 0.052823, 0.044808, 0.035852, 0.028765, 0.024575, 0.023787, 0.027617, 0.028867, 0.025492, 0.021981, 0.023674, 0.031105, 0.041681, 0.051935, 0.064361, 0.078548, 0.096428, 0.116013
#*# 	0.093715, 0.080137, 0.068771, 0.059581, 0.051514, 0.042546, 0.035937, 0.032505, 0.031989, 0.034788, 0.035659, 0.032158, 0.028708, 0.030074, 0.037904, 0.048655, 0.058568, 0.069941, 0.084838, 0.103469, 0.121127
#*# 	0.101372, 0.088217, 0.076353, 0.066099, 0.058709, 0.049348, 0.042612, 0.038884, 0.039226, 0.043007, 0.042845, 0.037967, 0.035381, 0.035729, 0.043058, 0.053295, 0.063294, 0.073964, 0.089086, 0.106470, 0.125402
#*# 	0.107000, 0.092743, 0.081768, 0.073388, 0.063760, 0.054873, 0.047854, 0.045119, 0.045487, 0.049353, 0.048493, 0.044725, 0.040557, 0.040747, 0.047709, 0.057457, 0.067328, 0.077268, 0.092501, 0.110612, 0.129888
#*# 	0.112158, 0.099774, 0.086945, 0.078073, 0.070351, 0.061206, 0.054520, 0.050217, 0.050702, 0.054082, 0.053567, 0.050061, 0.046043, 0.045155, 0.051257, 0.061199, 0.070529, 0.081696, 0.095891, 0.113827, 0.130203
#*# x_count = 21
#*# y_count = 17
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 52.2
#*# max_x = 177.8
#*# min_y = 64.201
#*# max_y = 165.798
#*#
#*# [axis_twist_compensation]
#*# z_compensations = -0.013931, 0.023180, -0.009249
#*# compensation_start_x = 20.0
#*# compensation_end_x = 200.0
